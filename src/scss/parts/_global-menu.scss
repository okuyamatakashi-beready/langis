@use '../variables' as *;

.global-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1000;

    // 初期状態を確実に非表示にしてフラッシュを防ぐ
    display: none; // display: none prevents FOUC
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease; // visibility transition removed due to display:none change

    &.is-active {
        display: block; // Show when active
        // Need a small delay or animation frame to trigger fade-in after display block, 
        // but for now let's just use keyframes or accept instant appearance if needed, 
        // OR better: use visibility but move z-index to -1 when hidden?
        // Let's stick to display: none/block for safety against flash.
        animation: fadeInMenu 0.3s forwards;
        pointer-events: auto;

        // 各アイテムを少しずつ遅らせて表示
        .global-menu__item {
            opacity: 1;
            transform: translateX(0);

            @for $i from 1 through 6 {
                &:nth-child(#{$i}) {
                    transition-delay: #{0.2 + ($i * 0.1)}s;
                }
            }
        }

        // Contactボタンも遅らせる
        .global-menu__contact {
            opacity: 1;
            transform: translateX(0);
            transition-delay: 0.8s;
        }
    }

    &__overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.95); // 白背景、少し透過？
    }

    &__container {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0; // 画面端まで使うためpadding削除
    }

    &__wrapper {
        display: flex;
        width: 100%;
        height: 100%;
        // max-width削除して全幅に
        align-items: center;
    }

    &__bg-visual {
        flex: 1;
        width: 50%; // 明示的に幅確保
        height: 100%;
        position: relative;
        background-repeat: no-repeat;
        background-position: left center; // 左端・中央
        background-size: contain;
        opacity: 1;

        @media screen and (max-width: $breakpoint-mobile) {
            width: 100%;
            height: 30%; // スマホでは高さを抑える
            background-position: center bottom; // 下寄せ
            background-size: cover;
            position: absolute; // 絶対配置で背面に
            bottom: 0;
            left: 0;
            opacity: 0.1; // 薄く表示
            z-index: -1;
        }
    }

    &__content {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding-left: 5%;
        padding-right: 5%; // 右端にも余白
        max-width: 800px; // コンテンツ側は広がりすぎないように

        @media screen and (max-width: $breakpoint-mobile) {
            padding: 20px;
            width: 100%;
            justify-content: flex-start;
            padding-top: 100px; // ヘッダー分空ける
        }
    }

    &__logo {
        margin-bottom: 50px;

        img {
            width: 350px; // ロゴサイズ調整
            height: auto;

            @media screen and (max-width: $breakpoint-mobile) {
                width: 200px; // スマホサイズ
                margin-bottom: 30px;
            }
        }
    }

    &__grid {
        display: grid;
        grid-template-columns: 1fr 1fr; // 2列
        grid-template-rows: repeat(4, min-content); // 4行（各項目の高さに合わせる）
        gap: 30px 60px; // 行間、列間
        width: 100%;

        @media screen and (max-width: $breakpoint-mobile) {
            display: flex; // スマホはFlexで縦積み
            flex-direction: column;
            gap: 20px;
        }
    }

    &__col,
    &__list {
        display: contents; // グリッドの直接の子要素として扱うためにラッパーを無視させる

        @media screen and (max-width: $breakpoint-mobile) {
            display: flex; // Flexに戻す
            flex-direction: column;
            gap: 20px;
        }
    }

    // 左列のアイテム配置
    &__col:first-child {
        .global-menu__item {
            grid-column: 1;

            &:nth-child(1) {
                grid-row: 1;
            }

            &:nth-child(2) {
                grid-row: 2;
            }

            &:nth-child(3) {
                grid-row: 3;
            }

            &:nth-child(4) {
                grid-row: 4;
            }

            // MEMBER
        }
    }

    // 右列のアイテム配置
    &__col:last-child {
        .global-menu__item {
            grid-column: 2;

            &:nth-child(1) {
                grid-row: 1;
            }

            // COMPANY
            &:nth-child(2) {
                grid-row: 2;
            }

            // GALLERY
        }
    }

    &__item {
        list-style: none; // マーカー削除
        opacity: 0;
        transform: translateX(30px);
        transition: opacity 0.5s ease, transform 0.5s ease;

        &::marker {
            display: none; // 念のため
            content: "";
        }

        a {
            text-decoration: none;
            display: block;
            transition: opacity 0.3s;

            &:hover {
                opacity: 0.7;
            }
        }

        .en {
            display: block;
            font-size: 24px; // 少し大きく
            font-weight: bold;
            color: $color-primary; // オレンジ
            margin-bottom: 5px;
            font-family: $font-family-base;
            letter-spacing: 0.05em;

            @media screen and (max-width: $breakpoint-mobile) {
                font-size: 18px; // スマホサイズ
            }
        }

        .ja {
            display: block;
            font-size: 14px;
            color: $color-text;
            font-weight: bold;

            @media screen and (max-width: $breakpoint-mobile) {
                font-size: 12px;
            }
        }
    }

    &__contact {
        grid-column: 2;
        grid-row: 4; // MEMBERと同じ行に配置
        align-self: start; // 上揃え（文字サイズ差などでずれないように）
        margin-top: 0;
        padding-top: 0;

        opacity: 0;
        transform: translateX(30px);
        transition: opacity 0.5s ease, transform 0.5s ease;

        @media screen and (max-width: $breakpoint-mobile) {
            margin-top: 30px; // 上に余白
        }
    }
}

// ヘッダーのトリガーボタンの開閉アニメーション
.header__menu-trigger.is-active {
    span {
        &:nth-of-type(1) {
            transform: translateY(8px) rotate(45deg);
        }

        &:nth-of-type(2) {
            opacity: 0;
        }

        &:nth-of-type(3) {
            transform: translateY(-8px) rotate(-45deg);
        }
    }
}